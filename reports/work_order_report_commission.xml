<?xml version="1.0" encoding="UTF-8"?>
<odoo>


	<report id="transp_driver_report"
				model="tranp.driver.report"
				string="حركه السائقين"
				report_type="qweb-pdf"
				name="qimamhd_transportation_v2_rads.transp_driver_report_view"
				file="qimamhd_transportation_v2_rads.transp_driver_report_view"
				 menu="True"

				/>
    <report
        id="transp_driver_report_xlsx"
        model="tranp.driver.report"
        string="Print to XLSX"
        report_type="xlsx"
        name="qimamhd_transportation_v2_rads.mntns_commission_report_xlsx_view"
        file="حركه السائقين"
        attachment_use="False"
        />

   

		<template id="transp_driver_report_view">
		    <t t-if="o and 'company_id' in o">
                <t t-set="company" t-value="o.company_id"></t>
            </t>
            <t t-if="not o or not 'company_id' in o">
                <t t-set="company" t-value="res_company"></t>
            </t>

			<div class="header">
                <div class="row mt32 mb32">
                    <div class="col-6">
						<t t-if="not user_id.branch_id.no_header_report_account">
							<t t-if="user_id.branch_id.branch_header">
								<img t-if="user_id.branch_id" t-att-src="'data:image/png;base64,%s' % to_text(user_id.branch_id.branch_header)"
									style="max-height: 200px;"/>
							</t>
							<t t-else="">
								<t t-if="company.header_image">
									<img t-if="company.header_image" t-att-src="'data:image/png;base64,%s' % to_text(company.header_image)"
										style="max-height: 200px;"/>
								</t>
						    </t>
						</t>
                    </div>
                </div>
            </div>
            <div class="footer">
                <div class="row mt32 mb32">
                    <div class="col-12">
						<t t-if="not user_id.branch_id.no_header_report_account">
							<t t-if="user_id.branch_id.branch_footer">
 								<img t-if="user_id.branch_id" t-att-src="'data:image/png;base64,%s' % to_text(user_id.branch_id.branch_footer)"
									style="max-height: 200px;"/>
									<!--<img src="/sale/static/img/lumar_cond.png" style="max-height:200px;"/>-->
									<br />
							</t>
							<t t-else="">
								<t t-if="company.footer_image">
									<img t-if="company.footer_image" t-att-src="'data:image/png;base64,%s' % to_text(company.footer_image)"
										style="max-height: 200px;"/>
										<!--<img src="/sale/static/img/lumar_cond.png" style="max-height:200px;"/>-->
										<br />
								</t>
							</t>
						</t>
                    </div>
                </div>
            </div>

			<t t-call ="web.html_container">

				<t t-call="web.external_layout">

<style>
        table {
          border-collapse: collapse;
          width: 100%;
           font-size:9px;
        }
        #t01 th, td {
          text-align: left;
          padding: 3px;
          font-size:9px;
          vertical-align: middle;
        }
</style>
<style>
#customers {
  border-collapse: collapse;
  width: 100%;
   border: 1px solid DarkOrange;

  overflow:hidden
}

#supplier {
  border-collapse: collapse;
  width: 100%;
   border: 1px solid DarkOrange;

  overflow:hidden
}

#customers td, #customers th {
  border: 1px solid gray;
  padding: 5px;
  text-align: right;
}

#supplier td, #supplier th {
  border: 1px solid #D3D3D3;
  padding: 8px;
  text-align: right;
  vertical-align: top;
}

#customers tr:nth-child(even){background-color: #F5F5F5;}

#customers tr:hover {background-color: #ddd;}

#customers th {
  padding-top: 5px;
  padding-bottom: 5px;
  text-align: right;


}

#supplier th {
  padding-top: 5px;
  padding-bottom: 5px;
  text-align: right;

}
</style>
<style>
#table1 {
  border-collapse: collapse;
  width: 100%;
  font-size:9px;
}

#table1 th, #table1 td {
  padding: 8px;
  text-align: right;
  font-size:9px;
}
</style>
<style>
  #foo {
position:absolute;
bottom:300px;
right:0px;
  }
</style>

						<div class="page">
              <br /> <br />
                  
								       <center><strong> تقرير حركه السائقين </strong></center>
 
                        <center>  
                            <br />
                            <strong> من تاريخ:</strong> <t t-esc="date_start"/>
                            <strong> الى تاريخ:</strong> <t t-esc="date_end"/>
                        </center>
                          <br />
                       
                                <t t-if="report_type == 'detail'">
                                   
                                    <t t-set="l_commisiion_total_all" t-value="0"/>
                                    <t t-foreach="company_car_driver" t-as="rec">
                                      <br></br>

                                      <div style="background-color:lightgray;color:black;">
                                          <strong> السائق: <span t-esc="rec.name"/></strong>
                                      </div>
                                            <table  id="customers">
                                              <thead>
                                                <tr class="text-center">
                                                    <th class="text-center" style="width: 5%">#</th>
                                                    <th class="text-center" style="width: 5%">رقم الشحنة</th>
                                                    <th class="text-center" style="width: 10%">تاريخ الطلب</th>
                                                    <th class="text-center" style="width: 10%">العميل</th>
                                                    <th class="text-center" style="width: 10%">سعر البيع</th>
                                                    <th class="text-center" style="width: 10%">سعر الوقفة</th>
                                                    <th class="text-center" style="width: 10%">ايام الوقفة</th>
                                                    <th class="text-center" style="width: 7%">مسار الشحن</th>
                                                    <th class="text-center" style="width: 10%">مسار التفريغ</th>
                                                    <th class="text-center" style="width: 10%">عمولة السائق</th>
                                                    <th class="text-center" style="width: 10%">نوع العمولة</th>
                                                    <th class="text-center" style="width: 10%">تاريخ الحمولة</th>
                                                    <th class="text-center" style="width: 10%">رقم البوليصة</th>
                                                    <th class="text-center" style="width: 10%">المورد</th>
                                                    <th class="text-center" style="width: 10%">السيارة</th>
                                                    <th class="text-center" style="width: 10%">هوية السائق</th>
                                                    <th class="text-center" style="width: 10%">جوال السائق</th>
                                                     <th class="text-center" style="width: 7%">رقم الفاتورة</th>
                                                    <th class="text-center" style="width: 7%">مركز التكلفة</th>

                                                    
                                                  
                                                </tr>
                                              </thead>
                                              <tbody>
                                              <t t-set="l_cnt" t-value="0"/>
                                               <t t-set="l_commission_total" t-value="0"/>
                                                <t t-foreach="docs_compelete.filtered(lambda x: x.company_driver_id.id == rec.id)" t-as="line">                                       
                                                  <tr>
                                                      <t t-set="l_cnt" t-value="l_cnt + 1"/>
                                                        <t t-set="comm_amount" t-value="0"/>

                                                      
                                                         <t t-set="comm_amount" t-value="line.driver_btrip_amount"/>

                                                         <t t-set="l_commission_total" t-value="comm_amount + l_commission_total"/>
                                                          
                                                         <t t-set="l_commisiion_total_all" t-value="comm_amount + l_commisiion_total_all"/>
                                                   
                                                      

                                                      
                                                    <td>
                                                        <span t-esc="l_cnt"/>
                                                    </td>
                                                        <td>
                                                        <span t-esc="line.seq"/>
                                                    </td>
                                                    
                                                      <td>
                                                        <span t-esc="line.order_date"/>
                                                    </td>
                                                  
                                                    <td>
                                                          <span style="color:gray;" /> <span t-esc="line.partner_branch_id.name"/> 
                                                    </td> 

                                                      <td>
                                                          <span style="color:gray;" /> <span t-esc="line.customer_price"/> 
                                                    </td>     
                                                      <td>
                                                          <span style="color:gray;" /> <span t-esc="line.customer_stop"/> 
                                                    </td>     
                                                      <td>
                                                          <span style="color:gray;" /> <span t-esc="line.stopped_days"/> 
                                                    </td>     

                                                    <td>
                                                      <span style="color:gray;" />  <span t-esc="line.transp_path_from.name"  />
                                                    </td>
                                                    <td>
                                                       <span style="color:gray;" />  <span t-esc="line.transp_path_to.name"  />
                                                    </td>
                                                      <td>
                                                        <span t-esc="comm_amount"/>
                                                    </td>
                                                    
                                                    <td>
                                                      <span style="color:gray;" /> <span t-esc="line.driver_btrip_selection"/>
                                                    </td>
                                                     <td>
                                                        <span style="color:gray;" /> <span t-esc="line.load_date"/>
                                                    </td>
                                                      <td>
                                                        <span style="color:gray;" /> <span t-esc="line.invoice_manual"/>
                                                    </td>
                                                      <td>
                                                        <span style="color:gray;" /> <span t-esc="line.supplier_id.name"/>
                                                    </td>
                                                    <td>
                                                        <span style="color:gray;" /> <span t-esc="line.product_car_id.name"/>
                                                    </td>
                                                    <td>
                                                      <span style="color:gray;" />  <span t-esc="line.driver_indentity"  />
                                                    </td>
                                                     <td>
                                                      <span style="color:gray;" />  <span t-esc="line.mobile_no"  />
                                                    </td>
                                                 
                                                    <td>
                                                          <span style="color:gray;" /> <span t-esc="line.sale_invoice_id.name"/> 
                                                    </td>
                                                    
                                                      <td>
                                                      <span style="color:gray;" />  <span t-esc="line.analytic_account_id.name"  />
                                                    </td>
                                                  
                                                    
                                                  </tr>
                                                    
                                              </t>
                                              </tbody>

                                              <tr style="background-color:gray;color:white;"  class="text-center">
                                                  <td  colspan="9">
                                                      <strong> 
                                                      الاجمالي  
                                                    </strong>
                                                </td>
 
                                                <td>
                                                    <strong>
          
                                                      <span t-esc=" '{:,.2f}'.format(l_commission_total )" /></strong>


                                                </td>
                                                
                                              </tr>
                                          </table>
                                        </t>  
                                      <table  id="customers">
                                      <tr style="background-color:gray;color:white;"  class="text-center">
                                          <td  colspan="13">
                                              <strong> اجمالي عمولات السائقين</strong>

                                          </td>
 
                                            <td style="color:white;">
                                              <strong>
    
                                                <span t-esc="'{:,.2f}'.format(l_commisiion_total_all)" /></strong>


                                          </td>

                                        </tr>


                                    </table>
                                </t>
                                <t t-if="report_type == 'summary'">
                                   <t t-set="l_amount_total_all" t-value="0"/>
                                    <t t-set="l_amount_tax_all" t-value="0"/>
                                    <t t-set="l_amount_untaxed_all" t-value="0"/>
                                    <t t-set="l_commission_amount_all" t-value="0"/>
                                    <table  id="customers">
                                        <thead>
                                          <tr class="text-center">
                                              <th class="text-center" style="width: 5%">#</th>
                                              <th class="text-center" style="width: 40%">المندوب</th>
                                              <th class="text-center" style="width: 15%">المبيعات قبل الضريبة</th>
                                              <th class="text-center" style="width: 15%">اجمالي الضريبة</th>
                                              <th class="text-center" style="width: 15%">المبيعات شامل الضريبة</th>
                                              <th class="text-center" style="width: 10%">اجمالي العمولة</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                        <t t-set="l_cnt" t-value="0"/>
                                            <t t-foreach="sale_mans" t-as="rec">
                                                <tr>
                                                   

                                                      <t t-set="l_amount_total" t-value="sum(l.amount_total if l.type == 'out_invoice' else l.amount_total * -1 for l in docs_compelete.filtered(lambda x: x.checkup_order_id.sale_man_id.id == rec.id))"/>
                                                      <t t-set="l_amount_tax" t-value="sum(l.amount_tax if l.type == 'out_invoice' else l.amount_tax *-1 for l in docs_compelete.filtered(lambda x: x.checkup_order_id.sale_man_id.id == rec.id))"/>
                                                      <t t-set="l_amount_untaxed" t-value="sum(l.amount_untaxed if l.type == 'out_invoice' else l.amount_untaxed * -1 for l in docs_compelete.filtered(lambda x: x.checkup_order_id.sale_man_id.id == rec.id))"/>
                                                      <t t-set="l_commission_amount" t-value="sum(l.checkup_order_id.commission_amount if l.type == 'out_invoice' else l.checkup_order_id.commission_amount * -1 for l in docs_compelete.filtered(lambda x: x.checkup_order_id.sale_man_id.id == rec.id))"/>
                                           
                                                      <t t-set="l_cnt" t-value="l_cnt + 1"/>
                                                   
                                                      <t t-set="l_amount_total_all" t-value="l_amount_total + l_amount_total_all"/>
                                                      <t t-set="l_amount_tax_all" t-value="l_amount_tax + l_amount_tax_all"/>
                                                      <t t-set="l_amount_untaxed_all" t-value="l_amount_untaxed + l_amount_untaxed_all"/>
                                                      <t t-set="l_commission_amount_all" t-value="l_commission_amount + l_commission_amount_all"/>


                                                    <td>
                                                        <span t-esc="l_cnt"/>
                                                    </td>

                                                    <td>
                                                        <span t-esc="rec.name"/>
                                                    </td>
                                                    <td>
                                                      <span style="color:gray;" />
                                                         <span t-esc="'{:,.2f}'.format(l_amount_untaxed)"/>
                                                      
                                                    </td>
                                                    <td>
                                                      <span style="color:gray;" />
                                                          <span t-esc="'{:,.2f}'.format(l_amount_tax)"/>
                                                        
                                                    </td>
                                                 
                                                    <td>
                                                       <span style="color:gray;" />
                                                          <span t-esc="'{:,.2f}'.format(l_amount_total)"/>
                                                      
                                                    </td>
                                                    <td>
                                                       <span style="color:gray;" />
                                                          <span t-esc="'{:,.2f}'.format(l_commission_amount)"/>
                                                      
                                                    </td>

                                                  </tr>
                                                    
                                              </t>
                                            </tbody>
                                            <tr style="background-color:gray;color:white;"  class="text-center">
                                            <td  colspan="2">
                                                <strong>   الاجمالي الكلي</strong>

                                            </td>

                                            <td style="color:white;">
                                                <strong>
      
                                                  <span t-esc="'{:,.2f}'.format(l_amount_untaxed_all)" /></strong>


                                            </td>
                                            <td style="color:white;">
                                                <strong>
                                                <span t-esc=" '{:,.2f}'.format(l_amount_tax_all)" /></strong>

                                            </td>
                                      
                                            <td style="color:white;">
                                                <strong>
                                                <span t-esc="'{:,.2f}'.format(l_amount_total_all)" /></strong>

                                            </td>
                                              
                                             <td style="color:white;">
                                                <strong>
                                                <span t-esc="'{:,.2f}'.format(l_commission_amount_all)" /></strong>

                                            </td>
                                              
                                          </tr>


                                    </table>

                                </t>
                                
                      
              </div>

              <p style="page-break-after:always;">
                      </p>
				</t>
				</t>
	</template>


</odoo>
